# Data Plotting {#Chap-02-02-visualization}

<hr>

<div style = "float:right; width:35%;">
<img src="visuals/badge-visualization.png" alt="badge-visualization">  
</div>  

Numerical summaries of complex data always incur information loss. Still lossy, but less so (if done well), is visualization. Any serious data analysis should start with a process in which the analyst becomes intimate with the data at hand. Visualization is an integral part of data-intimacy.

Section \@ref(Chap-02-04-Anscombe-example) demonstrates how summary statistics can be misleading and how a simple visualization can be much more revealing.
Section \@ref(Chap-02-04-good-visualization) offers some reflection on what makes a data visualization successful.
Section \@ref(Chap-02-04-ggplot) introduces the basics of data visualization with the `ggplot` package, an integral part of the tidyverse, based on a scatter plot for the [avocado price data](app-93-data-sets-avocado).
Going beyond scatter plots, section \@ref(Chap-02-04-geoms) looks at some common types of plots and how to realize them using the `geom_` family of functions in `ggplot`.


```{block, type='infobox'}
The learning goals for this chapter are:

- obtain a basic understanding of better/worse plotting
  - understand the idea of *hypothesis-driven visualization*
- develop a basic understanding of the 'grammar of graphs'
- understand the pros and cons of different frequent visualization strategies
  - barplots, densities, violins, error bars etc.
- be able to fine-tune graphs for better visualization

```


## Motivating example: Anscombe's quartet {#Chap-02-04-Anscombe-example}

To see how summary statistics can be highly misleading, and how a simple plot can reveal a lot more, consider a famous dataset available in R [@anscombe1973]: 

```{r}
glimpse(anscombe %>% as_tibble)
```

There are four pairs of $x$ and $y$ coordinates. Unfortunately, these are stored in long format with two pieces of information buried inside of the column name: for instance, the name `x3` contains the information that this column contains the $x$ coordinates for the 3rd pair. This is rather untidy. But, after the last section on data wrangling, we can tidy up quickly:

```{r}
tidy_anscombe <- anscombe %>% as_tibble %>% 
  pivot_longer(
    everything(),                  ## we want o pivot every column
    names_pattern = "(.)(.)",      ## use reg-exps to capture 1st and 2nd character
    names_to = c(".value", "grp")  ## assign names to new cols, using 1st part of
                                   ##   what reg-exp captures as new column names
  ) %>% 
  mutate(grp = paste0("Group ", grp))
tidy_anscombe
```

Here are some summary statistics for each of the four pairs:

```{r}
tidy_anscombe %>% 
  group_by(grp) %>% 
  summarise(
    mean_x    = mean(x),
    mean_y    = mean(y),
    min_x     = min(x),
    min_y     = min(y),
    max_x     = max(x),
    max_y     = max(y),
    r_squared = cor(x,y)^2
  )
```

<!-- EXERCISE: make the index the new column names instead -->

These numeric indicators suggest that each pair of $x$ and $y$ values is very similar. Only the ranges seem to differ. A brilliant example of how misleading numeric statistics can be, as compared to a plot of the data:^[It is not important to understand this code when you first read this chapter. But at the end of the chapter you should be able to understand (passively) what is going on here.]

```{r ch-02-anscombe, fig.cap="Anscombe's Quartet: four different data sets all of which receive the same correlation score."}
tidy_anscombe %>% 
  ggplot(aes(x, y)) +
    geom_smooth(method = lm, se = F, color = "black") +
    geom_point(color = project_colors[3], size = 2) +
    scale_y_continuous(breaks = scales::pretty_breaks()) +
    scale_x_continuous(breaks = scales::pretty_breaks()) +
    labs(title = "Anscombe's Quartet", x = NULL, y = NULL,
         subtitle = bquote(y == 0.5 * x + 3 ~ (R^2 %~~% .667) ~ "for all datasets")) +
    facet_wrap(~grp, ncol = 2, scales = "free_x") +
    theme(strip.background = element_rect(fill = "#f2f2f2", colour = "white"))
```

<!-- for exercise check out the work of Jan Verhove: -->
<!-- https://janhove.github.io/teaching/2016/11/21/what-correlations-look-like -->


## Visualization: the good, the bad and the info-graphic {#Chap-02-04-good-visualization}

Producing good data visualization is very difficult. There are no uncontroversial criteria for what a good visualization should be. There are, unfortunately, quite clear examples of really bad visualizations. We will look at some of these examples in the following.

An absolute classic on data visualization is an early book by Edward @Tufte1983:The-Visual-Disp entitled "The Visual Display of Quantitative Information". A distilled and over-simplified summary of Tufte's proposal is that we should eliminate *chart junk* and increase the *data-ink ratio*, a concept which Tufte defines formally. The more information (=data) a plot conveys, the higher the data-ink ratio. The more ink it requires, the lower it is. 

However, not all information in the data is equally relevant. Also, spending extra ink to reduce the recipients mental effort of retrieving the relevant information can be justified. Essentially, I would here propose to consider a special case of data visualization, common to scientific presentations. I want to speak of **hypothesis-driven visualization** as a way of communicating a clear message, the message we care most about at the current moment of (scientific) exchange. Though merely a special instances of all the goals one could pursue with data visualization, focusing on this special case is helpful because it allows us to formulate a (defeasible) rule of thumb for good visualization in analogy to how natural langauge ought to be used in order to achieve optimal cooperative information flow (at least as conceived by authors such as ...)

```{block, type='infobox'}
**The vague & defeasible rule of thump of good data visualization (according to the author).**

"Communicate a maximal degree of relevant true information in a way that minimizes the recipient's effort of retrieving this information."

```

Interestingly, just like natural language also needs to rely on a conventional medium for expressing ideas which might put additional constraints on what counts as optimal communication (e.g., we might not be allowed to drop a pronoun in English even though it is clearly recoverable from the context, and Italian speakers would happily omit it), so do certain unarticulated conventions in each specific scientific field.^[If your community only understands scatter plots and bar plots, it will not help communication but only mark you as a pompous show-off if you communicate in any other way, no matter how much better you think this is.]

Here are a few examples of bad plotting.^[For more disinspiration, see for example [this curated list of delightfully bad visualizations from actual publications](https://www.biostat.wisc.edu/~kbroman/topten_worstgraphs/).] To begin with, check out this fictitious data set:

```{r}
large_contrast_data <- tribble(
  ~group, ~treatment, ~measurement,
  "A",    "on",       1000,
  "A",    "off",      1002,
  "B",    "on",       992,
  "B",    "off",      990
)
```

If we are interested in any potential influence of variables `group` and `treatment` on the measurement in question, the following graph is ruinously unhelpful because the large size of the bars renders the relativly small differences between them almost entirely unspottable. 

```{r}
large_contrast_data %>% 
  ggplot(aes(x = group, y = measurement, fill = treatment)) +
  geom_bar(stat = "identity", position = "dodge")
```

A better visualization would be this:

```{r}
large_contrast_data %>% 
  ggplot(aes(
    x = group, 
    y = measurement, 
    shape = treatment, 
    color = treatment,
    group = treatment
    )
  ) +
  geom_point() +
  geom_line() +
  scale_y_continuous(breaks = scales::pretty_breaks())
```



The following examples use the [Bio-Logic Jazz-Metal data set](), in particular the following derived table of counts or the derived table of proprtions:

```{r}
BLJM_associated_counts
```

It is probably hard to believe but Figure \@ref(fig:chap-02-04-bar-plot-3d-BLJM) was obtained without further intentional uglification just by choosing a default 3D bar plot display in Microsoft's Excel. It does actually show the relevant information but it is entirely useless for a human observer without a magnifying glass, professional measuring tools and a calculator.

```{r chap-02-04-bar-plot-3d-BLJM, echo = F, out.width='80%', fig.cap="Example of a frontrunner for the prize of today's most complete disaster in the visual communication of information."}
knitr::include_graphics("visuals/bar-plot-3D-BLJM.png")
```


It gets slightly better with the following pie chart of the same numerical information, also generated with Microsoft's Excel. Subjectively, Figure \@ref(fig:chap-02-04-pie-chart-BLJM) is pretty much anything but pretty. Objectively, it is better than the previous visualization in terms of 3D bar plots shown in Figure \@ref(fig:chap-02-04-bar-plot-3d-BLJM) but the pie chart is still not useful for answering the question which we care about, namely whether logicians are more likely to prefer Jazz over Metal than biologists.

```{r chap-02-04-pie-chart-BLJM, echo = F, out.width='80%', fig.cap="Example of a rather unhelpful visual representation of the BLJM data (when the research question is whether logicians are more likely to prefer Jazz over Metal than biologists)."}
knitr::include_graphics("visuals/pie-chart-BLJM.png")
```

We can produce a much more useful representation with the code below. (A similar visualization also appeared as Figure \@ref(fig:chap-02-03-BLJM-proportions) in the previous chapter.)

```{r chap-02-04-BLJM-proportions, echo = T}
BLJM_associated_counts %>% 
  ggplot(
    aes(
      x = LB, 
      y = n, 
      color = JM, 
      shape = JM, 
      group = JM
    )
  ) +
  geom_point(size = 3) + geom_line() +
  labs(
    title = "Counts of choices of each music+subject pair",
    x = "",
    y = ""
  )
```

<div class="infobox">
**Info-Graphics.** Scientific communication with visualized data is different from other modes of communcation with visualized data. These other contexts come with different requirements for good data visualization. Good examples of highly successful *info-graphics* are produced by the famous illustrator Nigel Holmes, for instance. Figure \@ref(fig:chap-02-04-vampire-energy) is an example from Holmes' website showing different amounts of energy consumption for different household appliances. The purpose of this visualization is not (only) to communicate information about which of the listed household appliances is most energy intensive. It's main purpose is to raise awareness for the unexpectedly large energy consumption of housefold appliances in general (in stand-by mode).^[Image retrieved from [Nigel Holmes' website](http://www.nigelholmes.com) website on November 25 2019.]

```{r chap-02-04-vampire-energy, echo = F, out.width='95%', fig.cap="Example of an infographic. While possibly considered 'chart junk' in a scientific context, the eye-catching and highly memorable (and pretty!) artwork serve a strong secondary purpose in contexts other than scientific ones where hypothesis-driven precise communication with visually presented data is key."}
knitr::include_graphics("visuals/vampire-energy.png")
```

</div>


## Basics of `ggplot` {#Chap-02-04-ggplot}

## A rendezvous with popular geons {#Chap-02-04-geoms}

### Scatter

### Line

### Barplot

### Histogram

### Boxplot

### Density

### Violin

### Smooth

### Errorbar etc.

### 3D



